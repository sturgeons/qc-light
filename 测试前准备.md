# 测试前准备工作

## 1. 检查设备文件

在运行测试程序之前，需要确保串口设备文件存在并有正确的权限。

### 通过ADB连接设备并检查

```bash
# 1. 连接到设备shell
adb shell

# 2. 检查RS485设备（/dev/ttyS2）
ls -l /dev/ttyS2

# 3. 检查UART设备（/dev/ttyUSB0）
ls -l /dev/ttyUSB0

# 4. 如果权限不足，使用root权限修改
su
chmod 666 /dev/ttyS2
chmod 666 /dev/ttyUSB0
```

预期输出示例：
```
crw-rw---- 1 root dialout 4, 66 2024-10-16 10:00 /dev/ttyS2
crw-rw---- 1 root dialout 188, 0 2024-10-16 10:00 /dev/ttyUSB0
```

## 2. 编译和安装应用

### 方法一：使用Android Studio
1. 打开Android Studio
2. 导入项目：File -> Open -> 选择qc_1目录
3. 等待Gradle同步完成
4. 连接Android设备
5. 点击运行按钮（绿色三角形）或按 Shift+F10

### 方法二：使用命令行
```bash
# Windows PowerShell
cd C:\Users\yx392\AndroidStudioProjects\qc_1
.\gradlew.bat assembleDebug
adb install -r app\build\outputs\apk\debug\app-debug.apk
```

## 3. 运行应用

### 启动应用
```bash
adb shell am start -n com.example.qc_1/.MainActivity
```

### 查看应用日志
```bash
adb logcat -s SerialPort SerialPortHelper SerialPortManager
```

## 4. 测试步骤

### RS485测试流程
1. 打开应用
2. 在RS485部分选择合适的波特率（默认9600）
3. 点击"打开"按钮
4. 观察状态显示是否变为"已连接"
5. 从外部设备向/dev/ttyS2发送数据
6. 观察应用界面是否显示接收到的数据

### UART测试流程
1. 在UART部分选择合适的波特率（默认9600）
2. 点击"打开"按钮
3. 观察状态显示是否变为"已连接"
4. 从外部设备向/dev/ttyUSB0发送数据
5. 观察应用界面是否显示接收到的数据

## 5. 使用串口调试工具发送测试数据

如果您有另一个串口工具或设备，可以用它来发送测试数据：

### 使用minicom（Linux）
```bash
adb shell
minicom -D /dev/ttyS2 -b 9600
# 输入测试数据：Hello RS485
```

### 使用echo命令（简单测试）
```bash
adb shell
echo "Test Data" > /dev/ttyS2
```

## 6. 常见问题

### Q1: 设备文件不存在
**A:** 检查硬件连接，确保设备已正确连接到Android设备。

### Q2: 权限被拒绝
**A:** 使用su获取root权限，然后执行chmod 666修改权限。

### Q3: 应用无法打开串口
**A:** 
- 检查设备文件是否存在
- 检查权限是否正确
- 确认没有其他应用占用串口
- 查看logcat日志获取详细错误信息

### Q4: 接收到的数据是乱码
**A:** 
- 检查波特率是否匹配
- 确认数据格式（8N1）
- 检查硬件连接

## 7. 调试命令

### 查看所有串口设备
```bash
adb shell ls -l /dev/tty*
```

### 实时监控logcat
```bash
adb logcat | findstr "SerialPort"
```

### 检查应用权限
```bash
adb shell dumpsys package com.example.qc_1 | findstr "permission"
```

## 8. 波特率参考

程序支持以下波特率：
- 1200 bps
- 2400 bps
- 4800 bps
- **9600 bps** (默认，推荐用于初次测试)
- 19200 bps
- 38400 bps
- 57600 bps
- 115200 bps (常用于高速通信)
- 230400 bps
- 460800 bps

建议从9600开始测试，确认通信正常后再尝试更高波特率。

## 9. 硬件连接检查清单

- [ ] RS485设备已连接到正确的接口
- [ ] UART设备已连接到正确的USB端口
- [ ] 电源连接正常
- [ ] 信号线连接无误（A/B或TX/RX）
- [ ] 地线已正确连接
- [ ] 终端电阻已配置（RS485）

## 10. 性能监控

### 查看应用CPU和内存使用
```bash
adb shell top -n 1 | findstr qc_1
```

### 查看串口设备状态
```bash
adb shell cat /proc/tty/driver/serial
```

准备完成后，即可开始测试！

